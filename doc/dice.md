# ダイス

**注意**：イタズラ防止に、ダイスは一度に**200個**まで、面数は**1000面体**までに制限しています。

## 加算ロール（xDn）

発言中に半角で `個数dダイスの目+ボーナス` の形で記述することでダイスが振られます。ダイスロールを足したり引いたり、ボーナスを足したり引いたりも出来ます。

例）

```
2d6　　3d10+1　　4d8+2D6　3d6+2d10+4　　6D4-3　　6d6+4d8+6d10+3d20+4d4
3d6-1d4+1　　2d6-1d6
```

本来、書き連ねるダイスの数に制限はありません（1行がIRCで扱える長さであること）し、Rubyで扱える数値の範囲内であれば、ダイスの最大値も任意ですが、イタズラ防止にダイスは一度に**200個**まで、面数は**1000面体**までに制限しています（変更可能）。`d` は大文字でも小文字でもかまいません。ただし、これらのダイスは**必ず半角で**記述してください。

ダイスロール結果を整数倍（自然数倍）することも出来ます。

例）

```
3d6*2　　2d6*3-1d6+1
```

また、同じダイスを複数使うときには `(3+5)d6` というように `()` でくくっておくと先に計算してから処理されるようにしてみました。括弧内の算術記号は

* 加算：`+`
* 減算：`-`
* 乗算：`*`
* 除算：`/`

に対応しています。また `((1+2)*3)` のように、入れ子構造になっていても計算されます。これを「**括弧内前処理**」と呼ぶことにします。

例）

```
(2+3)d6-1+3d6+2　　　(2*3-4)d6-1d4+1　　　((2+3)*4/3)d6*2+5
```

加算ロールの結果に条件式で目標値を指定して、ゲーム固有の成功度判定を自動表示することができます。現在は `<=` と `>=` のみ対応。判定のためにはゲーム設定を行う必要があります。成功度を必要としない成功か失敗のみの判定は、ゲーム設定無しでも出来ます。

例）

```
1d100<=50　　　1D100<=25
```

## バラバラロール（xBn）

ダイスの値の和を使うのではなく「ある値以上のダイスの個数」を使うゲーム（シャドウランなど）にも対応しました。`D` の代わりに `B` を使うことで、合計ではなくバラバラの値が表示されます。ボーナスを記入することは出来ません。

例）

```
3b6　　　10b6　　　8B10
```

最後に条件を指定すると、条件にあうダイスがいくつあるのか数えます。使える条件は、

* 以上：`>=`
* 以下：`<=`
* 未満：`<`
* より大：`>`
* 以外：`<>`
* 同じ：`=`

です。ダイス同士の加算式のみ使えます。ただしダイスの面数は揃えてください。条件の数値に計算式は使えません。ただし括弧内前処理は可能です。

例）

```
10b6>=4　　　3B6<=3　　　2b6+3b6>=4　　　(3-2)b6=6
```

## 個数振り足しロール（xRn）

ダイスをバラバラにロールして、その成功数の個数分さらにロールして成功度を加算するロール（天羅万象など）にも対応しました。振り足し回数はゲーム設定で対応になっています（デフォルトは無限）。`B` のかわりに `R` を使うことで使用できます。条件式は必須で、ダイスの括弧内前処理も使えます。

例）

```
3r6>=4　　　3R6=6　　　3r6+2r6<=2　　　(3+2)r6>=5
```

## 上方無限ロール（xUn）

ダイスをバラバラにロールして、その結果が上方無限境界値以上になると再度振り、その値をダイス目に加えることができるロール（ロールマスターやシャドウランなど）にも対応しました。これは上方無限が成立し続ける限り振り続けます。`B` のかわりに `U` を使うことで使用できます。

境界値は `[境界値]` で指定するほかにマスターコマンドで自動設定もできます。条件式がない場合は、合計値が出るようにしました。条件式をつけると目標値にいくつ達したかも表示します。

例）

```
3u6[6]　　　1U100[96]+3　　　3u6+5u6[6]>=7　　　(5+6)u10[10]+5>=8
```

マスターコマンドで境界値登録してある場合は `3u6>=6` と記述できます。

## シークレットロール（Sダイスコマンド）

さらにこれらのダイスロールは他のプレイヤーに隠れてロールすることも可能です。ダイスコマンドの先頭に `S` をつけてロールすると本人だけに返事が返ってきます。

例）

```
S3D6　　　S3B6　　　S6R6>=5　　　S3u6+5u6[6]>=7
```

全員のシークレットロールの結果を一斉に公開することが出来ます。デフォルトの公開コマンドは `Open Dice!` です。

## プロットの登録

まずプレイ開始時に各自が「プロットの開示コマンド」を入力してください。これでプロットの結果をどこに表示したらいいかをダイスボットが覚えます。登録できるチャンネルは一つになっています。

実際に登録するときはボットとTalkで `PLOT:プロットの内容` と入力してください。入力が終わると結果を表示するチャンネルにメッセージが出ます。

例）

```
PLOT:折角だから俺はこの赤い扉を選ぶぜ　　PLOT:速度5
```

## プロットの開示

全員のプロット（最新のみ）を一斉に開示することが出来ます。デフォルトの公開コマンドは `Open Plot!` です。

## ランダム数値の埋め込み

ダイスの個数がランダムに変化するなど、コマンド中に乱数を埋め込む必要がある時には `[Min...Max]`（`Min`=乱数の最小値, `Max`=乱数の最大値。どちらも自然数）と書くと乱数を埋め込むことが出来ます。

例）

```
[1...5]D6　　　([2...4]+2)D10
×[(2+3)...8]D6（←これはNG
```
